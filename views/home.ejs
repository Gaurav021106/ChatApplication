<%- include('components/header') %>

  <div class="w-full h-screen bg-[#ABABAB]">
    <!-- Header -->
    <header class="h-[8vh] bg-[#D7D7D7] flex items-center rounded-b-4xl justify-between px-6 shadow">
      <!-- Left: Logo + Title -->
      <div class="flex items-center">
        <a href="#"><img src="/images/logo.jpg" class="w-[6vh] h-[6vh] rounded-full" alt="logo"></a>
        <h1 class="text-2xl font-bold ml-6">ChatRoom</h1>
      </div>

      <!-- Right: Dropdown -->
      <div class="relative inline-block" id="dropdownWrapper">
        <button id="dropdownButton" class="flex items-center hover:cursor-pointer">
          <div class="w-[6vh] h-[6vh] rounded-full overflow-hidden">
            <img src="<%= currentUser.profilePicture || '/images/default.jpg' %>" alt="profile"
              class="w-full h-full object-cover">
          </div>
          <svg viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5 text-gray-500 ml-2">
            <path
              d="M5.22 8.22a.75.75 0 0 1 1.06 0L10 11.94l3.72-3.72a.75.75 0 1 1 1.06 1.06l-4.25 4.25a.75.75 0 0 1-1.06 0L5.22 9.28a.75.75 0 0 1 0-1.06Z" />
          </svg>
        </button>
        <!-- Dropdown Menu -->
        <div id="dropdownMenu" class="hidden absolute right-0 mt-2 w-56 bg-white rounded-md shadow-lg z-50">
          <a href="/profile" class="block px-4 py-2 text-gray-700 hover:bg-gray-100">Profile</a>
          <a href="/" class="block px-4 py-2 text-gray-700 hover:bg-gray-100">Add Account</a>
          <a href="/logout" class="block px-4 py-2 text-red-600 hover:bg-gray-100">Logout</a>
        </div>
      </div>
    </header>

    <!-- Main Layout -->
    <main class="flex flex-row gap-2 mt-[1vh] w-full h-[90vh]">
      <!-- Left: Profile Section -->
      <div id="profile"
        class="bg-[#D7D7D7] w-[22%] rounded-4xl p-4 h-full shadow flex flex-col items-center text-center">
        <!-- Profile Picture -->
        <div class="w-[15vh] h-[15vh] rounded-full overflow-hidden bg-gray-300 shadow">
          <img src="<%= currentUser.profilePicture || '/images/default.jpg' %>" alt="profile"
            class="w-full h-full object-cover">
        </div>
        <h2 class="mt-3 text-xl font-bold">
          <%= currentUser.username %>
        </h2>
        <p class="text-sm text-gray-600">My Profile</p>

        <!-- Extra Links -->
        <div class="w-full mt-6 space-y-3">
          <a href="/profile"
            class="block w-full py-2 bg-[#ECECEC] rounded-3xl text-center font-medium hover:bg-white transition">View
            Profile</a>
          <a href="/settings"
            class="block w-full py-2 bg-[#ECECEC] rounded-3xl text-center font-medium hover:bg-white transition">Settings</a>
        </div>
      </div>

      <!-- Center: Chat Area -->
      <div id="chat-area"
        class="bg-[#D7D7D7] w-[58%] h-[90vh] rounded-4xl shadow flex items-center justify-center text-gray-500">
        <p>ðŸ’¬ Chat area coming soon...</p>
      </div>

      <!-- Right: Search + User List -->
      <div id="users-list" class="bg-[#D7D7D7] rounded-4xl w-[20%] h-[90vh] shadow flex flex-col overflow-hidden">

        <!-- Search Bar -->
        <div class="p-3 bg-[#ECECEC] rounded-t-4xl sticky top-0 z-10">
          <form method="GET" action="/home" class="mb-2">
            <input type="text" name="search" placeholder="Search users"
              class="w-full h-[5vh] bg-white text-center font-semibold rounded-full outline-none focus:ring-2 focus:ring-green-500">
          </form>
        </div>

        <!-- Scrollable Content -->
        <div class="flex-1 overflow-y-auto p-3 space-y-4">
          <!-- All Users -->
          <div>
            <h2 class="text-lg font-bold mb-2">All Users</h2>
            <% users.forEach(function(user) { %>
              <div
                class="h-[7vh] p-2 flex items-center rounded-full hover:bg-white hover:cursor-pointer mb-2 transition">
                <div class="w-[5vh] h-[5vh] rounded-full overflow-hidden bg-black">
                  <img src="<%= user.profilePicture || '/images/default.jpg' %>" alt="profile"
                    class="w-full h-full object-cover">
                </div>
                <div class="p-3 flex items-center justify-between w-full">
                  <h1 class="font-semibold">
                    <%= user.username %>
                  </h1>
                  <form method="POST" action="/users/add/<%= user._id %>">
                    <button type="submit" class="text-green-600 hover:text-green-800">
                      <i class="fa-solid fa-user-plus"></i>
                    </button>
                  </form>
                </div>
              </div>
              <% }) %>
          </div>

          <!-- Friend Requests -->
          <div>
            <h2 class="text-lg font-bold text-center">Requests</h2>
            <% if (currentUser.requests && currentUser.requests.length===0) { %>
              <p class="text-center text-gray-500 mt-3">No requests</p>
              <% } %>
                <% if (currentUser.requests) { %>
                  <% currentUser.requests.forEach(function(reqUser) { %>
                    <div class="h-[7vh] p-2 flex items-center justify-between rounded-full mb-2 bg-white shadow-sm">
                      <div class="flex items-center gap-3">
                        <div class="w-[5vh] h-[5vh] rounded-full overflow-hidden bg-black">
                          <img src="<%= reqUser.profilePicture || '/images/default.jpg' %>" alt="profile"
                            class="w-full h-full object-cover">
                        </div>
                        <h1 class="font-semibold">
                          <%= reqUser.username %>
                        </h1>
                      </div>
                      <div class="flex gap-2">
                        <form method="POST" action="/users/accept/<%= reqUser._id %>">
                          <button type="submit"
                            class="px-3 text-sm text-white rounded-3xl bg-blue-600 hover:bg-blue-700">Accept</button>
                        </form>
                        <form method="POST" action="/users/reject/<%= reqUser._id %>">
                          <button type="submit"
                            class="px-3 text-sm text-white rounded-3xl bg-red-600 hover:bg-red-700">Reject</button>
                        </form>
                      </div>
                    </div>
                    <% }) %>
                      <% } %>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- Dropdown Script -->
  <script>
    const button = document.getElementById('dropdownButton');
    const menu = document.getElementById('dropdownMenu');

    button.addEventListener('click', () => {
      menu.classList.toggle('hidden');
    });

    window.addEventListener('click', (e) => {
      if (!document.getElementById('dropdownWrapper').contains(e.target)) {
        menu.classList.add('hidden');
      }
    });
  </script>

  <%- include('components/footer') %>