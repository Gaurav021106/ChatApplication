<%- include('components/header') %>
  <div class="h-screen w-full bg-gray-100 flex flex-col">
    <header class="h-[8vh] bg-[#D7D7D7] flex items-center rounded-b-3xl justify-between px-6 shadow">
      <!-- Left: Logo + Title -->
      <div class="flex items-center">
        <a href="#"><img src="/images/logo.jpg" class="w-[6vh] h-[6vh] rounded-full" alt="logo"></a>
        <h1 class="text-2xl font-bold ml-6">ChatRoom</h1>
      </div>

      <!-- Right: Dropdown -->
      <div class="relative inline-block" id="dropdownWrapper">
        <button id="dropdownButton" aria-haspopup="true" aria-expanded="false"
          class="flex items-center hover:cursor-pointer">
          <div class="w-[6vh] h-[6vh] rounded-full overflow-hidden">
            <img src="<%= currentUser.profilePicture || '/images/default.jpg' %>" alt="profile"
              class="w-full h-full object-cover">
          </div>
          <svg viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5 text-gray-500 ml-2">
            <path
              d="M5.22 8.22a.75.75 0 0 1 1.06 0L10 11.94l3.72-3.72a.75.75 0 1 1 1.06 1.06l-4.25 4.25a.75.75 0 0 1-1.06 0L5.22 9.28a.75.75 0 0 1 0-1.06Z" />
          </svg>
        </button>
        <!-- Dropdown Menu -->
        <div id="dropdownMenu"
          class="hidden absolute right-0 mt-2 w-56 bg-white rounded-md shadow-lg z-50 transition transform opacity-0 scale-95 duration-200 ease-out">
          <a href="/home" class="block px-4 py-2 text-gray-700 hover:bg-gray-100">Home</a>
          <a href="/profile" class="block px-4 py-2 text-gray-700 hover:bg-gray-100">Profile</a>
          <a href="/" class="block px-4 py-2 text-gray-700 hover:bg-gray-100">Add Account</a>
          <a href="/logout" class="block px-4 py-2 text-red-600 hover:bg-gray-100">Logout</a>
        </div>
      </div>
    </header>
    <!-- Profile Section -->
    <section class="w-full h-[30vh] flex flex-col items-center justify-center">
      <div class="w-[20vh] h-[20vh] mt-5 rounded-full overflow-hidden  shadow">
        <form hidden id="upload-form" action="/fileupload" method="post" enctype="multipart/form-data"
          onsubmit="document.getElementById('upload-spinner').classList.remove('hidden')">
          <input id="file-upload" type="file" name="image" />
        </form>
        <img src="<%= currentUser.profilePicture %>" alt="profile"
          class="w-full h-full object-cover">
      </div>
      <h1 class="font-bold text-2xl mb-1">
        <%= currentUser.FullName %>
      </h1>
      <p class="text-sm mb-2 text-gray-700">@<%= currentUser.username %>
      </p>
    </section>

    <!-- Friends / Requests / Add Friends -->
    <section class="w-full h-[70vh] flex flex-row items-start justify-center gap-6 px-6">

      <!-- Friends -->
      <div class="flex-1 max-w-[60vh] h-full bg-gray-300 shadow-md rounded-lg p-4 flex flex-col">
        <h2 class="font-bold text-lg mb-3">Friends</h2>
        <div class="flex-1 bg-gray-100 p-3 rounded-2xl overflow-y-auto">
          <% if (currentUser.friends.length===0) { %>
            <p class="text-center text-gray-500 mt-3">No friends yet</p>
            <% } %>
              <% currentUser.friends.forEach(friend=> { %>
                <div class="flex justify-between items-center border-b py-2">
                  <span>
                    <%= friend.FullName %>
                  </span>
                  <form method="POST" action="/users/remove/<%= friend._id %>">
                    <button type="submit" class="text-red-500 text-sm">Remove</button>
                  </form>
                </div>
                <% }) %>
        </div>
      </div>

      <!-- Requests -->
      <div class="flex-1 max-w-[60vh] h-full bg-gray-300 shadow-md rounded-lg p-4 flex flex-col">
        <h2 class="font-bold text-lg mb-3">Requests</h2>
        <div class="flex-1 bg-gray-100 p-3 rounded-2xl overflow-y-auto">
          <% if (currentUser.requests.length===0) { %>
            <p class="text-center text-gray-500 mt-3">No requests</p>
            <% } %>
              <% currentUser.requests.forEach(reqUser=> { %>
                <div class="flex justify-between items-center border-b py-2">
                  <span>
                    <%= reqUser.FullName %>
                  </span>
                  <div class="flex gap-2">
                    <form method="POST" action="/users/accept/<%= reqUser._id %>">
                      <button type="submit" class="bg-blue-500 text-white px-3 py-1 rounded">Accept</button>
                    </form>
                    <form method="POST" action="/users/reject/<%= reqUser._id %>">
                      <button type="submit" class="bg-red-500 text-white px-3 py-1 rounded">Reject</button>
                    </form>
                  </div>
                </div>
                <% }) %>
        </div>
      </div>

      <!-- Add Friends -->
      <div class="flex-1 max-w-[60vh] h-full bg-gray-300 shadow-md rounded-lg p-4 flex flex-col">
        <h2 class="font-bold text-lg mb-3">Add Friends</h2>
        <div class="flex-1 bg-gray-100 p-3 rounded-2xl overflow-y-auto">
          <% users.forEach(user=> { %>
            <div class="flex justify-between items-center border-b py-2">
              <span>
                <%= user.FullName %> (@<%= user.username %>)
              </span>
              <form method="POST" action="/users/add/<%= user._id %>">
                <button type="submit" class="bg-green-500 text-white px-3 py-1 rounded">Add</button>
              </form>
            </div>
            <% }) %>
        </div>
      </div>

    </section>
  </div>
  <%- include('components/footer') %>